C  CLACULATING OF XGPDF(X,Q^2) BY DGLAP EVOLUTION OF INITIAL CONDITION 
C  XGPDF(X,Q^2_0)
C ORIGINALLY WRITTEN BY S. SAPETA 
C MODIFIED AND TRANSLATED TO FORTRAN BY T. GODA 
C
      INCLUDE "./clenshaw.f"

CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C    GAMMA TILDE
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      FUNCTION GAMMATILDE( N ) 
      IMPLICIT NONE
      EXTERNAL WPSIPG
      DOUBLE COMPLEX GAMMATILDE,WPSIPG,N,N1,N2,N3,L1,L2,T1,T2,T3,CX
      DOUBLE PRECISION M1,M2,RL
      INTEGER K
      DOUBLE PRECISION N_F, EULERGAMMA
c      COMMON /CONST/ N_F,BETA,N_0, EULERGAMMA
      PARAMETER(K=0, N_F=3D0,
     & EULERGAMMA=0.577215664901532860606512090082402431042D0 )
      N1 = N+1D0;
      N2 = N+2D0;
      N3 = N+3D0;
      L1 = DCONJG(N)*DCONJG(N1)
      M1 = CDABS(N)*CDABS(N)*CDABS(N1)*CDABS(N1)
      T1 = 1D0/M1*L1
      L2 = DCONJG(N2)*DCONJG(N3)
      M2 = CDABS(N2)*CDABS(N2)*CDABS(N3)*CDABS(N3)
      T2 = 1D0/M2*L2
      T3 = WPSIPG(N2,K);
      CX = T1+T2-T3
      RL = 11D0/2D0-N_F/3D0 -6D0*EULERGAMMA;
      GAMMATILDE = 6D0*CX+RL
c      GAMMATILDE = N

      RETURN
      END
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C    INTEGRAND OF GLUONS PDF 
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      FUNCTION XGPDF_INTEGRAND (Y,PAR) 
      IMPLICIT NONE
      EXTERNAL GAMMATILDE
      EXTERNAL WGAMMA
      DOUBLE PRECISION PAR(3)
      DOUBLE COMPLEX N0,N1,N2,G1,G2,GT,EX,L,GAMMATILDE,WGAMMA
      DOUBLE PRECISION XGPDF_INTEGRAND, M, Y
      DOUBLE PRECISION BETA,N_0, EULERGAMMA
c      COMMON /CONST/ N_F,BETA,N_0, EULERGAMMA
      DOUBLE PRECISION YG,TG,LAMBDA_G
C      COMMON /PARAM/ YG, TG, LAMBDAG
      PARAMETER( BETA =6.6D0,N_0= 0.5D0,
     & EULERGAMMA= 0.577215664901532860606512090082402431042D0)
      YG=PAR(1)
      TG=PAR(2)
      LAMBDA_G=PAR(3)
      N0 = DCMPLX(N_0,Y)
      N1 = DCMPLX(-LAMBDA_G+N_0,Y)
      N2 = DCMPLX(-LAMBDA_G+BETA+N_0,Y)
      G1 = WGAMMA(N1)
      G2 = WGAMMA(N2)
      GT = TG*GAMMATILDE(N0)
      
      EX = CDEXP(DCMPLX(0D0,Y*YG)+GT)
      L = G1*DCONJG(G2)
      M = CDABS(G2)*CDABS(G2)
      XGPDF_INTEGRAND =DBLE( (L/M)*EX) 
      IF(ISNAN(XGPDF_INTEGRAND)) THEN
              XGPDF_INTEGRAND=0D0
      ENDIF
      RETURN 
      END
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CC GLUON
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      FUNCTION XGPDF(X,QQ,A_G,LAMBDA_G)
      IMPLICIT NONE
      EXTERNAL DGAMMF
      EXTERNAL DCLENSHAW
      EXTERNAL XGPDF_INTEGRAND
      DOUBLE PRECISION XGPDF,DGAMMF, DCLENSHAW, XGPDF_INTEGRAND
      DOUBLE PRECISION PAR(3)
      DOUBLE PRECISION A_G
      DOUBLE PRECISION X, QQ , NORMALIZATION, BPRIM
      DOUBLE PRECISION N_F,BETA,N_0, EULERGAMMA,LAMBDA2
      DOUBLE PRECISION PI,Q0
c      COMMON /CONST/ N_F,BETA,N_0, EULERGAMMA
      DOUBLE PRECISION YG,TG,LAMBDA_G
      PARAMETER( N_0= 0.5D0, N_F=3D0,
     & EULERGAMMA =0.577215664901532860606512090082402431042D0,
     & LAMBDA2= 0.09D0, Q0=1D0,
     & PI =3.141592653589793238462643383279502884197D0)
C      COMMON /PARAM/ YG, TG, LAMBDAG
c      PARAMETER(LAMBDA2=0.09D0,
c     & PI=3.141592653589793238462643383279502884197D0,
c     & Q0=1D0)
c      BETA=6.6D0
c      N_F=3D0
c      N_0=0.5D0
c      EULERGAMMA=0.577215664901532860606512090082402431042D0
      PAR(3)=LAMBDA_G
      BPRIM = 33d0/6d0-N_F/3d0
      PAR(1) = DLOG(1D0/X)
C      YG= DLOG(1/X)
      PAR(2) = (1D0/BPRIM)*DLOG(DLOG(QQ/LAMBDA2)/DLOG(Q0/LAMBDA2))
C      TG= (1/BPRIM)*DLOG(DLOG(QQ/LAMBDA2)/DLOG(Q0/LAMBDA2))
      NORMALIZATION = A_G*DEXP(N_0* PAR(1) )*DGAMMF(BETA)/PI
      XGPDF=DCLENSHAW(XGPDF_INTEGRAND,PAR,0d0,150d0,1.0D-12,1.0D-15)
      XGPDF=XGPDF*NORMALIZATION
      IF (ISNAN(XGPDF)) THEN
c              WRITE(6,"(A5 E9.2 A5 E9.2)") " X= ",X," Q2= ", QQ
              xgpdf=0d0;
      ENDIF
  100 RETURN
      END
